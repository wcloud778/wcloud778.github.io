<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>正在跳转到打开网站...</title>
  <style>
    body {
      background-color: #fff;
      font-size: 14px;
    }

    h3 {
      font-size: 60px;
      color: #eee;
      text-align: center;
      padding-top: 30px;
      font-weight: normal;
    }
  </style>
</head>
<body>
  <h3>正在打开网站</h3>
  <div id="msg"></div>
  <script>
    var uid = getQueryString("n");
    if (!uid) {
        uid = location.search;
        uid = uid.replace("?","");
    }
    uid = uid.replace("/", "");
    uid = uid.replace("%2F", "");

    var redirectUrl = '';

    function openWebsite() {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                clearTimeout(timeoutId);  // 清除超时计时器

                if (xhr.status === 200) {
                    var result = JSON.parse(xhr.responseText);
                    console.log(result);
                    if (result.code == 200) {
                        if (isWeChat()) {
                            redirectUrl = result.data.wechat_url;
                        } else if (isQQ()) {
                            redirectUrl = result.data.qq_url;
                        } else {
                            redirectUrl = result.data.short_url;
                        }
                        location.replace(redirectUrl);
                    } else {
                        document.getElementById("msg").innerHTML = result.msg;
                    }
                } else {
                    document.getElementById("msg").innerHTML = "服务器错误";
                }   
            }
        };
      
        xhr.open("GET", "https://admin.gua.gay/qmhppp/apikey.php?key=" + uid, true);
        xhr.send();
    }

    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return decodeURI(r[2]);
        return null;
    }

    function isWeChat() {
        var ua = navigator.userAgent.toLowerCase();
        return ua.indexOf("micromessenger") !== -1;
    }

    function isQQ() {
        var ua = navigator.userAgent.toLowerCase();
        return ua.indexOf("qq/") !== -1;
    }

    // 设置超时时间（单位：毫秒）
    var TIMEOUT = 5000;
    var timeoutId = setTimeout(function() {
        // 在超时后执行的逻辑，例如显示错误信息或进行其他操作
        document.getElementById("msg").innerHTML = "请求超时，请稍后重试";
    }, TIMEOUT);

    openWebsite();
  </script>
</body>
</html>
